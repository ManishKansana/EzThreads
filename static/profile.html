<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="profstyle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="/bolt.svg">
    <title>reConnect</title>
</head>
<body>
    <!--nav bar-->
    <div class="navbar">
      <div class="left">
        <!-- <img src="bolt.svg" alt="bolt">
        <a href="/home" class="brand">ReConnect</a> -->
        <button id="home-button" class="icon-button" href="/home">
          <img src="bolt.svg" alt="home">
        </button>
        <a href="/home" class="brand">reConnect</a>
      </div>
      <div class="center">
        <input id="searchBar" type="text" placeholder="Search...">
        <!-- <img id="searchButton" src="magnifier.svg" alt="magnifier"> -->
        <div class="search">
          <button id="search-button" class="icon-button">
            <img src="magnifier.svg" alt="magnifier">
          </button>
        </div>
      </div>
      <div class="right">
        <!--post button-->
        <button id="post-button" class="icon-button">
          <img src="add.svg" alt="add">
        </button>
        <!--notification button-->
        <!--TODO: Add notification dropdown-->
          <div class="notification">
            <button id="notification-button" class="icon-button">
              <img src="bell.svg" alt="bell">

          </div>
          <a href="#" id="friendsButton">Friends</a>
          <a href="/profile" id="profileButton">Profile</a>
      </div>
    </div>

    <div class="wrapper">
      <div class="left-sidebar">

      </div>

      <div class="middle-section">
        <div class= "profile-information">
          <div class="userinfo">
            <img width="100" height="100" src="https://img.icons8.com/ios/100/test-account.png" alt="test-account"/>
            <h2 id="username">Loading...<h2>
            <button id="friendRequestButton">Send Friend Request</button>
            <button id="logoutButton" href="/login">Log Out</button>
          </div>
        </div>
        <div class="posts-container">
          <div class="post" id="post1">
            <!-- <h2>Post ID: <%= post.ID %></h2> -->
            <h2 id="author1">Loading...</h2>
            <p id="content1">Loading...</p>
            <p id="likes1">Loading...</p>
            <p id="shares1">Loading...</p>
              <div class="comments">
                <h3>Comments <a href="#" id="addCommentButton1"><b>[+]</b></a></h3>
                <ul id="post1comments">
                      <!-- <li><%= comment %></li> -->
                </ul>
              </div>
          </div>
          <div class="post" id="post2">
            <!-- <h2>Post ID: <%= 1 %></h2> -->
            <h2 id="author2">Loading...</h2>
            <p id="content2">Loading...</p>
            <p id="likes2">Loading...</p>
            <p id="shares2">Loading...</p>
              <div class="comments">
                <h3>Comments <a href="#" id="addCommentButton2"><b>[+]</b></a></h3>
                <ul id="post2comments">
                      <!-- <li><%= comment %></li> -->
                </ul>
              </div>
          </div>
          <div class="post" id="post3">
            <!-- <h2>Post ID: <%= post.ID %></h2> -->
            <h2 id="author3">Loading...</h2>
            <p id="content3">Loading...</p>
            <p id="likes3">Loading...</p>
            <p id="shares3">Loading...</p>
              <div class="comments">
                <h3>Comments <a href="#" id="addCommentButton3"><b>[+]</b></a></h3>
                <ul id="post3comments">
                      <!-- <li><%= comment %></li> -->
                </ul>
              </div>
          </div>
          <div class="post" id="post4">
            <!-- <h2>Post ID: <%= post.ID %></h2> -->
            <h2 id="author4">Loading...</h2>
            <p id="content4">Loading...</p>
            <p id="likes4">Loading...</p>
            <p id="shares4">Loading...</p>
              <div class="comments">
                <h3>Comments <a href="#" id="addCommentButton4"><b>[+]</b></a></h3>
                <ul id="post4comments">
                      <!-- <li><%= comment %></li> -->
                </ul>
              </div>
          </div>
          <div class="post" id="post5">
            <!-- <h2>Post ID: <%= post.ID %></h2> -->
            <h2 id="author5">Loading...</h2>
            <p id="content5">Loading...</p>
            <p id="likes5">Loading...</p>
            <p id="shares5">Loading...</p>
              <div class="comments">
                <h3>Comments <a href="#" id="addCommentButton5"><b>[+]</b></a></h3>
                <ul id="post5comments">
                      <!-- <li><%= comment %></li> -->
                </ul>
              </div>
          </div>
       </div>
      </div>

      <div class="right-sidebar">
        
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      let socket = io();
      // everything else goes here
      // variable init
      let profileButton = document.getElementById("profileButton");
      profileButton.addEventListener("click", (evt)=>{
        socket.emit("nextProfile", "ownProfile");
      });

      let searchButton = document.getElementById("search-button");
      let searchTerm = document.getElementById("searchBar").value;
      searchButton.addEventListener("click", (evt)=>{
        searchTerm = document.getElementById("searchBar").value;
        location.href = "/results";
        socket.emit("search request", searchTerm);
      });

      let currentPosts = new Array();
      let currentLikeCounts = new Array();
      let currentShareCounts = new Array();

      let post1 = document.getElementById("post1");
      let post2 = document.getElementById("post2");
      let post3 = document.getElementById("post3");
      let post4 = document.getElementById("post4");
      let post5 = document.getElementById("post5");

      let author1 = document.getElementById("author1");
      let author2 = document.getElementById("author2");
      let author3 = document.getElementById("author3");
      let author4 = document.getElementById("author4");
      let author5 = document.getElementById("author5");

      let content1 = document.getElementById("content1");
      let content2 = document.getElementById("content2");
      let content3 = document.getElementById("content3");
      let content4 = document.getElementById("content4");
      let content5 = document.getElementById("content5");

      let likes1 = document.getElementById("likes1");
      let likes2 = document.getElementById("likes2");
      let likes3 = document.getElementById("likes3");
      let likes4 = document.getElementById("likes4");
      let likes5 = document.getElementById("likes5");

      let friendRequestButton = document.getElementById("friendRequestButton");
      friendRequestButton.addEventListener("click", (evt)=>{
        if(friendRequestButton.disabled){
          return;
        }
        socket.emit("friend request", currentUser);
      });

      friendRequestButton.style.display = "none"; // by default, enabled if needed (hypothetically)

      let logoutButton = document.getElementById("logoutButton");
      logoutButton.addEventListener("click", (evt)=>{
        socket.emit("log out", "true");
        location.href = "/login";
      });

      logoutButton.style.display = "none"; // by default also

      likes1.addEventListener("click", (evt)=>{
        socket.emit("like request", currentPosts[0]);
      });
      likes2.addEventListener("click", (evt)=>{
        socket.emit("like request", currentPosts[1]);
      });
      likes3.addEventListener("click", (evt)=>{
        socket.emit("like request", currentPosts[2]);
      });
      likes4.addEventListener("click", (evt)=>{
        socket.emit("like request", currentPosts[3]);
      });
      likes5.addEventListener("click", (evt)=>{
        socket.emit("like request", currentPosts[4]);
      });

      let shares1 = document.getElementById("shares1");
      let shares2 = document.getElementById("shares2");
      let shares3 = document.getElementById("shares3");
      let shares4 = document.getElementById("shares4");
      let shares5 = document.getElementById("shares5");

      shares1.addEventListener("click", (evt)=>{
        socket.emit("share request", currentPosts[0]);
      });
      shares2.addEventListener("click", (evt)=>{
        socket.emit("share request", currentPosts[1]);
      });
      shares3.addEventListener("click", (evt)=>{
        socket.emit("share request", currentPosts[2]);
      });
      shares4.addEventListener("click", (evt)=>{
        socket.emit("share request", currentPosts[3]);
      });
      shares5.addEventListener("click", (evt)=>{
        socket.emit("share request", currentPosts[4]);
      });

      let post1comments = document.getElementById("post1comments");
      let post2comments = document.getElementById("post2comments");
      let post3comments = document.getElementById("post3comments");
      let post4comments = document.getElementById("post4comments");
      let post5comments = document.getElementById("post5comments");

      let addCommentButton1 = document.getElementById("addCommentButton1");
      let addCommentButton2 = document.getElementById("addCommentButton2");
      let addCommentButton3 = document.getElementById("addCommentButton3");
      let addCommentButton4 = document.getElementById("addCommentButton4");
      let addCommentButton5 = document.getElementById("addCommentButton5");

      addCommentButton1.addEventListener("click", (evt)=>{
        // popup
      });
      addCommentButton2.addEventListener("click", (evt)=>{
        // popup
      });
      addCommentButton3.addEventListener("click", (evt)=>{
        // popup
      });
      addCommentButton4.addEventListener("click", (evt)=>{
        // popup
      });
      addCommentButton5.addEventListener("click", (evt)=>{
        // popup
      });

      // button handlers
      let notifButton = document.getElementById("notification-button");
      let createButton = document.getElementById("post-button");
      let friendsButton = document.getElementById("friendsButton");

      notifButton.addEventListener("click", (evt)=>{
        // popup
      });

      createButton.addEventListener("click", (evt)=>{
        // popup
      });

      friendsButton.addEventListener("click", (evt)=>{
        socket.emit("search request", "friends");
        location.href = "/friends";
      });

      let currentUser = -1;
      let username = document.getElementById("username");

      // by default
      post1.style.display = "none";
      post2.style.display = "none";
      post3.style.display = "none";
      post4.style.display = "none";
      post5.style.display = "none";

      // backend will handle which profile to send -- front end will tell backend whether the next profile displayed is curr user or a friend?
      socket.emit("need profile", "");

      socket.on("here profile", (dta)=>{
        // *** don't know if the frontend actually needs userID?
        // data in form of [[userID, username, isFriend], [postID, username, content, likes, shares], [comment1, comment2, ...], ...] and so on

        currentUser = dta[0][0];
        username.innerText = dta[0][1];
        if(dta[0][2] == -1){
          friendRequestButton.style.display = "none";
          logoutButton.style.display = "block";
        }
        else if(dta[0][2] == 0){
          friendRequestButton.style.display = "block";
          friendRequestButton.disabled = false;
        }
        else if(dta[0][2] == 1){
          friendRequestButton.style.display = "block";
          friendRequestButton.disabled = true;
          friendRequestButton.innerText = "Request Pending";
        }
        else if(dta[0][2] == 2){
          friendRequestButton.style.display = "block";
          friendRequestButton.disabled = true;
          friendRequestButton.innerText = "Friends"
        }

        for(let i = 0; i < dta[1].length; i+=2){
          // grab the post ID
          currentPosts.push(dta[1][i][0]);
          currentLikeCounts.push(dta[1][i][3].length);
          currentShareCounts.push(dta[1][i][4]);
          // first post
          if(i == 0){
            post1.style.display = "block";
            author1.innerText = dta[1][i][1];
            content1.innerText = dta[1][i][2];
            likes1.innerText = "Likes: " + dta[1][i][3].length;
            shares1.innerText = "Shares: " + dta[1][i][4];
            for(let j = 0; j < dta[1][i+1].length; j++){
              // append comments to the div
              let li = document.createElement("li");
              li.appendChild(document.createTextNode(dta[1][i+1][j]));
              post1comments.appendChild(li);
            }

          }
          // second post
          else if(i == 2){
            post2.style.display = "block";
            author2.innerText = dta[1][i][1];
            content2.innerText = dta[1][i][2];
            likes2.innerText = "Likes: " + dta[1][i][3].length;
            shares2.innerText = "Shares: " + dta[1][i][4];
            for(let j = 0; j < dta[1][i+1].length; j++){
              // append comments to the div
              let li = document.createElement("li");
              li.appendChild(document.createTextNode(dta[1][i+1][j]));
              post2comments.appendChild(li);
            }
          }
          // third post
          else if(i == 4){
            post3.style.display = "block";
            author3.innerText = dta[1][i][1];
            content3.innerText = dta[1][i][2];
            likes3.innerText = "Likes: " + dta[1][i][3].length;
            shares3.innerText = "Shares: " + dta[1][i][4];
            for(let j = 0; j < dta[1][i+1].length; j++){
              // append comments to the div
              let li = document.createElement("li");
              li.appendChild(document.createTextNode(dta[1][i+1][j]));
              post3comments.appendChild(li);
            }
          }
          // fourth post
          else if(i == 6){
            post4.style.display = "block";
            author4.innerText = dta[1][i][1];
            content4.innerText = dta[1][i][2];
            likes4.innerText = "Likes: " + dta[1][i][3].length;
            shares4.innerText = "Shares: " + dta[1][i][4];
            for(let j = 0; j < dta[1][i+1].length; j++){
              // append comments to the div
              let li = document.createElement("li");
              li.appendChild(document.createTextNode(dta[1][i+1][j]));
              post4comments.appendChild(li);
            }
          }
          // fifth post
          else if(i == 8){
            post5.style.display = "block";
            author5.innerText = dta[1][i][1];
            content5.innerText = dta[1][i][2];
            likes5.innerText = "Likes: " + dta[1][i][3].length;
            shares5.innerText = "Shares: " + dta[1][i][4];
            for(let j = 0; j < dta[1][i+1].length; j++){
              // append comments to the div
              let li = document.createElement("li");
              li.appendChild(document.createTextNode(dta[1][i+1][j]));
              post5comments.appendChild(li);
            }
          }
        }

      });

      socket.on("like result", (data)=>{
        if(data[0] == "true"){
          if(data[1] == currentPosts[0]){
            currentLikeCounts[0]++;
            likes1.innerText = "Likes: " + currentLikeCounts[0];
          }
          else if(data[1] == currentPosts[1]){
            currentLikeCounts[1]++;
            likes2.innerText = "Likes: " + currentLikeCounts[1];
          }
          else if(data[1] == currentPosts[2]){
            currentLikeCounts[2]++;
            likes3.innerText = "Likes: " + currentLikeCounts[2];
          }
          else if(data[1] == currentPosts[3]){
            currentLikeCounts[3]++;
            likes4.innerText = "Likes: " + currentLikeCounts[3];
          }
          else if(data[1] == currentPosts[4]){
            currentLikeCounts[4]++;
            likes5.innerText = "Likes: " + currentLikeCounts[4];
          }
          else{
            console.log("failed to like post");
          }
        }
        else{
          console.log("couldn't like post")
        }
      });

      // TODO notifications?
      socket.on("share result", (data)=>{
        if(data[0] == "true"){
          if(data[1] == currentPosts[0]){
            currentShareCounts[0]++;
            shares1.innerText = "Shares: " + currentShareCounts[0];
          }
          else if(data[1] == currentPosts[1]){
            currentShareCounts[1]++;
            shares2.innerText = "Shares: " + currentShareCounts[1];
          }
          else if(data[1] == currentPosts[2]){
            currentShareCounts[2]++;
            shares3.innerText = "Shares: " + currentShareCounts[2];
          }
          else if(data[1] == currentPosts[3]){
            currentShareCounts[3]++;
            shares4.innerText = "Shares: " + currentShareCounts[3];
          }
          else if(data[1] == currentPosts[4]){
            currentShareCounts[4]++;
            shares5.innerText = "Shares: " + currentShareCounts[4];
          }
          else{
            console.log("failed to share post");
          }
        }
        else{
          console.log("couldn't share post")
        }
      });

      socket.on("friend request result", (data)=>{
        // data is t/f
        if(data == "true"){
          friendRequestButton.disabled = true;
          friendRequestButton.innerText = "Request Pending";
        }
        // else it will stay as is
      });
    </script>
</body>
</html>
